import{p as he,g as Ce,z,t as O,ad as Te,at as Be,l as Ie,o as l,H as ee,q as K,aK as Me,aL as De,aM as Ue,af as Re,aN as _e,A as v,ab as Ae,aA as He,Y as Ne,ac as Y,aw as Ee,aO as Ge,aP as ue,aQ as ze,aR as $e,w as ne,ae as Le,aS as Oe,aT as qe,aU as We,Z as te,aV as je,ai as Ke,av as Qe,_ as Xe,y as Ye,s as Je,B as Ze,C as ae,D as ea,F as u,E as le,aW as ie,Q as aa,L as j,N as q,a4 as J,aX as ta,R as la,G as oa,X as de,S as ce,P as ve,U as me,K as o,W as ge,aY as fe,a3 as pe,V as sa,a1 as ra,a2 as ua,J as na}from"./index-4c6fc963.js";import{c as ia,a as oe,f as da,d as ca,u as va,e as Z,V as Ve}from"./index.esm-ede2464d.js";import{b as ma,V as ga,a as se}from"./VRow-aab2122c.js";import{m as fa,a as pa,b as Va,c as ba,d as ya,e as xa,f as wa,u as Pa,p as ka,g as Sa,h as ha,i as Ca,j as Ia,k as Fa,l as Ta,n as be,o as ye,q as xe,r as we,s as Pe}from"./VDataTable-7397cdbd.js";import{V as ke}from"./VCheckbox-963eb1b3.js";import"./VList-8cfaf16e.js";import"./ssrBoot-1ca997ca.js";import"./VDivider-c6ecf1ad.js";import"./VCheckboxBtn-35ba150d.js";const Ba=he({itemsLength:{type:[Number,String],required:!0},...fa(),...pa(),...Va()},"VDataTableServer"),Ma=Ce()({name:"VDataTableServer",props:Ba(),emits:{"update:modelValue":e=>!0,"update:page":e=>!0,"update:itemsPerPage":e=>!0,"update:sortBy":e=>!0,"update:options":e=>!0,"update:expanded":e=>!0,"update:groupBy":e=>!0},setup(e,Q){let{attrs:$,slots:s}=Q;const{groupBy:m}=ba(e),{sortBy:d,multiSort:F,mustSort:R}=ya(e),{page:V,itemsPerPage:N}=xa(e),L=z(()=>parseInt(e.itemsLength,10)),{columns:E,headers:W}=wa(e,{groupBy:m,showSelect:O(e,"showSelect"),showExpand:O(e,"showExpand")}),{items:T}=Pa(e,E),{toggleSort:h}=ka({sortBy:d,multiSort:F,mustSort:R,page:V}),{opened:G,isGroupOpen:B,toggleGroup:P,extractRows:M}=Sa({groupBy:m,sortBy:d}),{pageCount:D,setItemsPerPage:U}=ha({page:V,itemsPerPage:N,itemsLength:L}),{flatItems:p}=Ca(T,m,G),{isSelected:k,select:A,selectAll:H,toggleSelect:_,someSelected:b,allSelected:r}=Ia(e,{allItems:T,currentPage:T}),{isExpanded:g,toggleExpand:f}=Fa(e),y=z(()=>M(T.value));Ta({page:V,itemsPerPage:N,sortBy:d,groupBy:m,search:O(e,"search")}),Te("v-data-table",{toggleSort:h,sortBy:d}),Be({VDataTableRows:{hideNoData:O(e,"hideNoData"),noDataText:O(e,"noDataText"),loading:O(e,"loading"),loadingText:O(e,"loadingText")}});const c=z(()=>({page:V.value,itemsPerPage:N.value,sortBy:d.value,pageCount:D.value,toggleSort:h,setItemsPerPage:U,someSelected:b.value,allSelected:r.value,isSelected:k,select:A,selectAll:H,toggleSelect:_,isExpanded:g,toggleExpand:f,isGroupOpen:B,toggleGroup:P,items:y.value.map(C=>C.raw),internalItems:y.value,groupedItems:p.value,columns:E.value,headers:W.value}));Ie(()=>{const C=be.filterProps(e),I=ye.filterProps(e),x=xe.filterProps(e),n=we.filterProps(e);return l(we,K({class:["v-data-table",{"v-data-table--loading":e.loading},e.class],style:e.style},n),{top:()=>{var a;return(a=s.top)==null?void 0:a.call(s,c.value)},default:()=>{var a,w,t,i,S,X;return s.default?s.default(c.value):l(ee,null,[(a=s.colgroup)==null?void 0:a.call(s,c.value),l("thead",{class:"v-data-table__thead",role:"rowgroup"},[l(ye,K(I,{sticky:e.fixedHeader}),s)]),(w=s.thead)==null?void 0:w.call(s,c.value),l("tbody",{class:"v-data-table__tbody",role:"rowgroup"},[(t=s["body.prepend"])==null?void 0:t.call(s,c.value),s.body?s.body(c.value):l(xe,K($,x,{items:p.value}),s),(i=s["body.append"])==null?void 0:i.call(s,c.value)]),(S=s.tbody)==null?void 0:S.call(s,c.value),(X=s.tfoot)==null?void 0:X.call(s,c.value)])},bottom:()=>s.bottom?s.bottom(c.value):l(be,C,{prepend:s["footer.prepend"]})})})}});const Da=he({autoGrow:Boolean,autofocus:Boolean,counter:[Boolean,Number,String],counterValue:Function,prefix:String,placeholder:String,persistentPlaceholder:Boolean,persistentCounter:Boolean,noResize:Boolean,rows:{type:[Number,String],default:5,validator:e=>!isNaN(parseFloat(e))},maxRows:{type:[Number,String],validator:e=>!isNaN(parseFloat(e))},suffix:String,modelModifiers:Object,...Me(),...De()},"VTextarea"),Se=Ce()({name:"VTextarea",directives:{Intersect:Ue},inheritAttrs:!1,props:Da(),emits:{"click:control":e=>!0,"mousedown:control":e=>!0,"update:focused":e=>!0,"update:modelValue":e=>!0},setup(e,Q){let{attrs:$,emit:s,slots:m}=Q;const d=Re(e,"modelValue"),{isFocused:F,focus:R,blur:V}=_e(e),N=z(()=>typeof e.counterValue=="function"?e.counterValue(d.value):(d.value||"").toString().length),L=z(()=>{if($.maxlength)return $.maxlength;if(!(!e.counter||typeof e.counter!="number"&&typeof e.counter!="string"))return e.counter});function E(r,g){var f,y;!e.autofocus||!r||(y=(f=g[0].target)==null?void 0:f.focus)==null||y.call(f)}const W=v(),T=v(),h=Ae(""),G=v(),B=z(()=>e.persistentPlaceholder||F.value||e.active);function P(){var r;G.value!==document.activeElement&&((r=G.value)==null||r.focus()),F.value||R()}function M(r){P(),s("click:control",r)}function D(r){s("mousedown:control",r)}function U(r){r.stopPropagation(),P(),te(()=>{d.value="",je(e["onClick:clear"],r)})}function p(r){var f;const g=r.target;if(d.value=g.value,(f=e.modelModifiers)!=null&&f.trim){const y=[g.selectionStart,g.selectionEnd];te(()=>{g.selectionStart=y[0],g.selectionEnd=y[1]})}}const k=v(),A=v(+e.rows),H=z(()=>["plain","underlined"].includes(e.variant));He(()=>{e.autoGrow||(A.value=+e.rows)});function _(){e.autoGrow&&te(()=>{if(!k.value||!T.value)return;const r=getComputedStyle(k.value),g=getComputedStyle(T.value.$el),f=parseFloat(r.getPropertyValue("--v-field-padding-top"))+parseFloat(r.getPropertyValue("--v-input-padding-top"))+parseFloat(r.getPropertyValue("--v-field-padding-bottom")),y=k.value.scrollHeight,c=parseFloat(r.lineHeight),C=Math.max(parseFloat(e.rows)*c+f,parseFloat(g.getPropertyValue("--v-input-control-height"))),I=parseFloat(e.maxRows)*c+f||1/0,x=Qe(y??0,C,I);A.value=Math.floor((x-f)/c),h.value=Ke(x)})}Ne(_),Y(d,_),Y(()=>e.rows,_),Y(()=>e.maxRows,_),Y(()=>e.density,_);let b;return Y(k,r=>{r?(b=new ResizeObserver(_),b.observe(k.value)):b==null||b.disconnect()}),Ee(()=>{b==null||b.disconnect()}),Ie(()=>{const r=!!(m.counter||e.counter||e.counterValue),g=!!(r||m.details),[f,y]=Ge($),{modelValue:c,...C}=ue.filterProps(e),I=ze(e);return l(ue,K({ref:W,modelValue:d.value,"onUpdate:modelValue":x=>d.value=x,class:["v-textarea v-text-field",{"v-textarea--prefixed":e.prefix,"v-textarea--suffixed":e.suffix,"v-text-field--prefixed":e.prefix,"v-text-field--suffixed":e.suffix,"v-textarea--auto-grow":e.autoGrow,"v-textarea--no-resize":e.noResize||e.autoGrow,"v-input--plain-underlined":H.value},e.class],style:e.style},f,C,{centerAffix:A.value===1&&!H.value,focused:F.value}),{...m,default:x=>{let{id:n,isDisabled:a,isDirty:w,isReadonly:t,isValid:i}=x;return l($e,K({ref:T,style:{"--v-textarea-control-height":h.value},onClick:M,onMousedown:D,"onClick:clear":U,"onClick:prependInner":e["onClick:prependInner"],"onClick:appendInner":e["onClick:appendInner"]},I,{id:n.value,active:B.value||w.value,centerAffix:A.value===1&&!H.value,dirty:w.value||e.dirty,disabled:a.value,focused:F.value,error:i.value===!1}),{...m,default:S=>{let{props:{class:X,...re}}=S;return l(ee,null,[e.prefix&&l("span",{class:"v-text-field__prefix"},[e.prefix]),ne(l("textarea",K({ref:G,class:X,value:d.value,onInput:p,autofocus:e.autofocus,readonly:t.value,disabled:a.value,placeholder:e.placeholder,rows:e.rows,name:e.name,onFocus:P,onBlur:V},re,y),null),[[Le("intersect"),{handler:E},null,{once:!0}]]),e.autoGrow&&ne(l("textarea",{class:[X,"v-textarea__sizer"],id:`${re.id}-sizer`,"onUpdate:modelValue":Fe=>d.value=Fe,ref:k,readonly:!0,"aria-hidden":"true"},null),[[Oe,d.value]]),e.suffix&&l("span",{class:"v-text-field__suffix"},[e.suffix])])}})},details:g?x=>{var n;return l(ee,null,[(n=m.details)==null?void 0:n.call(m,x),r&&l(ee,null,[l("span",null,null),l(qe,{active:e.persistentCounter||F.value,value:N.value,max:L.value},m.counter)])])}:void 0})}),We({},W,T,G)}});const Ua=e=>(ra("data-v-c16fae7a"),e=e(),ua(),e),Ra=Ua(()=>na("h1",{class:"text-center"},"師傅管理",-1)),_a={__name:"WorkerView",setup(e){const{mobile:Q}=Ye(),$=z(()=>Q.value),s=v(!1),{apiAuth:m}=aa(),d=Je(),F=v(null),R=v(!1),V=v(""),N=n=>{n?(V.value=n._id,B.value.value=n.name,P.value.value=n.price,M.value.value=n.description,D.value.value=n.category,U.value.value=n.sell):V.value="",R.value=!0,s.value=!0},L=()=>{for(R.value=!1,G();p.value.length>0;)F.value.deleteFileRecord(p.value[0])},E=["生理男","生理女"],W=ia({name:oe().required("缺少師傅姓名"),price:da().typeError("商品價格格式錯誤").required("缺少時段價格").min(0,"價格不能小於0"),description:oe().required("缺少師傅說明"),category:oe().required("缺少類別分類").test("isCategory","商品分類錯誤",n=>E.includes(n)),sell:ca()}),{handleSubmit:T,isSubmitting:h,resetForm:G}=va({validationSchema:W,initialValues:{name:"",price:0,description:"",category:"",sell:!1}}),B=Z("name"),P=Z("price"),M=Z("description"),D=Z("category"),U=Z("sell"),p=v([]),k=v([]),A=T(async n=>{var a,w,t;if(!(p.value>0&&((a=p.value[0])!=null&&a.error))&&!(V.value===""&&p.value.length===0))try{const i=new FormData;for(const S in n)i.append(S,n[S]);if(p.value.length>0)for(const S of p.value)i.append("image",S.file);V.value===""?await m.post("/products",i):await m.patch("/products/"+V.value,i),d({text:V.value===""?"新增成功":"編輯成功",showCloseButton:!1,snackbarProps:{timeout:1500,color:"#8C8987",location:"center"}}),L(),x()}catch(i){console.log(i);const S=((t=(w=i==null?void 0:i.response)==null?void 0:w.data)==null?void 0:t.message)||"發生錯誤，請稍後再試";d({text:S,showCloseButton:!1,snackbarProps:{timeout:1500,color:"error",location:"center"}})}}),H=v(5),_=[{value:5,title:"5"},{value:10,title:"10"},{value:25,title:"25"},{value:50,title:"50"},{value:100,title:"100"},{value:-1,title:"$vuetify.dataFooter.itemsPerPageAll"}],b=v([{key:"name",order:"desc"}]),r=v(1),g=v([]),f=[{title:"圖片",align:"center",sortable:!1,key:"image[0]"},{title:"名稱",align:"center",sortable:!0,key:"name"},{title:"價格",align:"center",sortable:!0,key:"price"},{title:"分類",align:"center",sortable:!0,key:"category"},{title:"上架",align:"center",sortable:!0,key:"sell"},{title:"編輯",align:"center",sortable:!1,key:"edit"}],y=v(!0),c=v(0),C=v(""),I=async()=>{var n,a,w,t;I.value=!0;try{const{data:i}=await m.get("/products/all",{params:{page:r.value,itemsPerPage:H.value,sortBy:((n=b.value[0])==null?void 0:n.key)||"name",sortOrder:((a=b.value[0])==null?void 0:a.order)==="asc"?1:-1,search:C.value}});g.value.splice(0,g.value.length,...i.result.data),c.value=i.result.total}catch(i){console.log(i);const S=((t=(w=i==null?void 0:i.response)==null?void 0:w.data)==null?void 0:t.message)||"發生錯誤，請稍後再試";d({text:S,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"center"}})}y.value=!1};I();const x=()=>{r.value=1,I()};return(n,a)=>{const w=Ze("vue-file-agent");return ae(),ea(ee,null,[l(ga),l(ma,{class:"d-flex justify-center"},{default:u(()=>[l(se,{cols:"12"},{default:u(()=>[Ra]),_:1}),l(se,{class:"text-center",cols:"12"},{default:u(()=>[l(j,{class:"login",onClick:a[0]||(a[0]=t=>N())},{default:u(()=>[q("新增師傅")]),_:1})]),_:1}),l(se,{cols:"11"},{default:u(()=>[l(Ma,{"items-per-page":H.value,"onUpdate:itemsPerPage":[a[2]||(a[2]=t=>H.value=t),I],"sort-by":b.value,"onUpdate:sortBy":[a[3]||(a[3]=t=>b.value=t),I],page:r.value,"onUpdate:page":[a[4]||(a[4]=t=>r.value=t),I],items:g.value,"items-per-page-options":_,headers:f,loading:y.value,"items-length":c.value,search:C.value,hover:""},{top:u(()=>[l(J,{label:"搜尋",modelValue:C.value,"onUpdate:modelValue":a[1]||(a[1]=t=>C.value=t),clearable:"","append-inner-icon":"mdi-magnify","onClick:appendInner":x,onKeydown:ta(x,["enter"])},null,8,["modelValue"])]),"item.image[0]":u(({item:t})=>[l(la,{src:t.image[0],height:"50px"},null,8,["src"])]),"item.sell":u(({item:t})=>[t.sell?(ae(),le(sa,{key:0,icon:"mdi-check",color:"green"})):oa("",!0)]),"item.edit":u(({item:t})=>[l(j,{icon:"mdi-pencil",variant:"text",color:"#d9d5d2",onClick:i=>N(t)},null,8,["onClick"])]),_:2},1032,["items-per-page","sort-by","page","items","loading","items-length","search"])]),_:1})]),_:1}),$.value?(ae(),le(ie,{key:0,class:"w-75",modelValue:R.value,"onUpdate:modelValue":a[12]||(a[12]=t=>R.value=t),persistent:""},{default:u(()=>[l(Ve,{disabled:o(h),onSubmit:pe(o(A),["prevent"])},{default:u(()=>[l(de,null,{default:u(()=>[l(ce,null,{default:u(()=>[q(ve(V.value===""?"新增師傅":"編輯師傅"),1)]),_:1}),l(me,null,{default:u(()=>[l(J,{label:"姓名",modelValue:o(B).value.value,"onUpdate:modelValue":a[5]||(a[5]=t=>o(B).value.value=t),"error-messages":o(B).errorMessage.value},null,8,["modelValue","error-messages"]),l(J,{label:"價格/1H",modelValue:o(P).value.value,"onUpdate:modelValue":a[6]||(a[6]=t=>o(P).value.value=t),"error-messages":o(P).errorMessage.value},null,8,["modelValue","error-messages"]),l(Pe,{label:"分類",items:E,modelValue:o(D).value.value,"onUpdate:modelValue":a[7]||(a[7]=t=>o(D).value.value=t),"error-messages":o(D).errorMessage.value},null,8,["modelValue","error-messages"]),l(ke,{label:"上架",modelValue:o(U).value.value,"onUpdate:modelValue":a[8]||(a[8]=t=>o(U).value.value=t),"error-messages":o(U).errorMessage.value},null,8,["modelValue","error-messages"]),l(Se,{label:"說明",modelValue:o(M).value.value,"onUpdate:modelValue":a[9]||(a[9]=t=>o(M).value.value=t),"error-messages":o(M).errorMessage.value},null,8,["modelValue","error-messages"]),l(w,{modelValue:p.value,"onUpdate:modelValue":a[10]||(a[10]=t=>p.value=t),rawModelValue:k.value,"onUpdate:rawModelValue":a[11]||(a[11]=t=>k.value=t),accept:"image/jpeg,image/png",deletable:"","error-text":{type:"檔案格式不支援",size:"檔案超過 1 MB 限制"},"help-text":"選擇檔案或拖曳到這","max-files":3,"max-size":"1MB",ref_key:"fileAgent",ref:F},null,8,["modelValue","rawModelValue"])]),_:1}),l(ge,null,{default:u(()=>[l(fe),l(j,{color:"red",disabled:o(h),onClick:L},{default:u(()=>[q("取消")]),_:1},8,["disabled"]),l(j,{color:"green",type:"submit",loading:o(h)},{default:u(()=>[q("送出")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1},8,["modelValue"])):(ae(),le(ie,{key:1,class:"w-50",modelValue:R.value,"onUpdate:modelValue":a[20]||(a[20]=t=>R.value=t),persistent:""},{default:u(()=>[l(Ve,{disabled:o(h),onSubmit:pe(o(A),["prevent"])},{default:u(()=>[l(de,null,{default:u(()=>[l(ce,null,{default:u(()=>[q(ve(V.value===""?"新增師傅":"編輯師傅"),1)]),_:1}),l(me,null,{default:u(()=>[l(J,{label:"姓名",modelValue:o(B).value.value,"onUpdate:modelValue":a[13]||(a[13]=t=>o(B).value.value=t),"error-messages":o(B).errorMessage.value},null,8,["modelValue","error-messages"]),l(J,{label:"價格/1H",modelValue:o(P).value.value,"onUpdate:modelValue":a[14]||(a[14]=t=>o(P).value.value=t),"error-messages":o(P).errorMessage.value},null,8,["modelValue","error-messages"]),l(Pe,{label:"分類",items:E,modelValue:o(D).value.value,"onUpdate:modelValue":a[15]||(a[15]=t=>o(D).value.value=t),"error-messages":o(D).errorMessage.value},null,8,["modelValue","error-messages"]),l(ke,{label:"上架",modelValue:o(U).value.value,"onUpdate:modelValue":a[16]||(a[16]=t=>o(U).value.value=t),"error-messages":o(U).errorMessage.value},null,8,["modelValue","error-messages"]),l(Se,{label:"說明",modelValue:o(M).value.value,"onUpdate:modelValue":a[17]||(a[17]=t=>o(M).value.value=t),"error-messages":o(M).errorMessage.value},null,8,["modelValue","error-messages"]),l(w,{modelValue:p.value,"onUpdate:modelValue":a[18]||(a[18]=t=>p.value=t),rawModelValue:k.value,"onUpdate:rawModelValue":a[19]||(a[19]=t=>k.value=t),multiple:"",accept:"image/jpeg,image/png",deletable:"","error-text":{type:"檔案格式不支援",size:"檔案超過 1 MB 限制"},"help-text":"選擇檔案或拖曳到這","max-files":3,"max-size":"1MB",ref_key:"fileAgent",ref:F},null,8,["modelValue","rawModelValue"])]),_:1}),l(ge,null,{default:u(()=>[l(fe),l(j,{color:"red",disabled:o(h),onClick:L},{default:u(()=>[q("取消")]),_:1},8,["disabled"]),l(j,{color:"green",type:"submit",loading:o(h)},{default:u(()=>[q("送出")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1},8,["modelValue"]))],64)}}},qa=Xe(_a,[["__scopeId","data-v-c16fae7a"]]);export{qa as default};
